
# CONT File Format

The CONT file is short for Contest. The file name is followed by three numbers starting at 000, example CONT.000 . This file is generated by the Contest Server from Team Entry files produced by players. Most of these structures are copies of the data generated from the original Team Entry file but ordered slightly differently.
The Contest file consists of five main data structures:
* Header
  * The header consists of a status byte and absolute file offsets to each of the data structures
* Player information
  * Includes User Id, team colors, and team name, player user name, and location
* Dino information
  * Includes species, Dino properties, initial map location and Dino names 
* Level information 
  * This is the normal level data structure
* Contest action data
  * This is the result of decision data simulated on the Contest Server. Includes everything from fighting moves to regular movements, neck movements, fire actions, and death as well

## Contest Header Structure
 
|Field|Size (bytes)|Position (hex)|Description
|--|--|--|--|	
|Contest Status|1|0|0x1=Not watched and first offset Won, 0x2=Not Watched and second offset Won, 0x3=Not watched and Draw.||
|Team 1 colors & strings|2|1||	
|Team 1 data|2|3||	
|Zeros|2|5||	
|Team 2 colors & strings|2|7||
|Team 2 data|2|9||
|Zeros|2|B||
|Level Data|2|D||
|Contest Data Offset|2|F|The actual contest data!!!|

## Team Information Data Structure

|Field|Size (bytes)|Description|
|--|--|--|
|Pyro User ID|4|Only include if it is equal to our Pyro User ID, otherwise it should be zeros|
|Marking and Skin Colors|C|0-99d||
|Fire Colors|6|0-99d||	
|Team Name|Zero terminated|When loading the contest menu page, Program checks Pyro User ID initially. Uses the enemy team name as the title. Later on, it checks this again, and prints the appropriate home team and enemy team names|
|Team Player Name|Zero terminated||
|Team Location|Zero terminated||

## Team Dino Data

|Field|Size (bytes)|Description|
|--|--|--|
|Num species|1||
|Species data|20h * num species||
|Total Dino’s|1||
|Queen Data|Num Dinos||
|Species leg type + straight/sprawling|Num Dino’s|	Changing the value here causes Leg changes when contest run
|Dino struct data|3 * num Dino’s|This data is in the actual contest entry as well|
|Team Dino X Pos|2 * Num Dinos||
|Team Dino Y Pos|2 * Num Dinos||
|Team Dino Rotation|2 * Num Dinos	
|Some Other Data|2 * Num Dinos||
|Dino Names|Zero Terminated, must be less than 50 chars|This logs the file offset of the Dino name and when the L key is pressed, looks up the name from the file|

## Contest Data Structure

The Contest Data is a series of Game Tick Frame Structures which encapsulate a set of Actions which were recorded from each Dino at that point-in-time. A Dino's action may or may not be included in any given Frame Structure. If too many frames with actions on the same dino are encountered in succession, they are "dropped" as an animation may still be running, causing the action data to be "out of sync" with what is happening on the screen. Manually tuned delays are included as a guideline for Contest AI. 
### Frame Structure
|Field|Size|Description|
|--|--|--|
|Number of Actions|1 byte|This is a counter of how many actions are in this structure. Does not include arguments in this number as they are consumed while the action is being handled||
|Actions|Number of Actions|This is an array of Action Structures with their arguments included as separate bytes, if required||

### Actions Structure
The Actions Structure within each Data Structure contains the following information
|Field|Size (bytes)|Description|
|--|--|--|
|Input_Byte|1|This is a single encoded byte which represents Dino_Index (0-9) and an Action (0-11). Together these select a Dino in the Contest Array and an Action to perform on that Dino||
|Arguments|Variable|Depending on the Action, there may be 0 or up to 2 arguments required||

### Encoding/Decoding Algorithm
Decoding algorithm has been reversed! It is straight forward so a simple encoding algorithm has been derived.

Dino_Index = a number between 0 and 9 relative to how many Dinos are actually included in the Contest data. Specifying a number outside of this range will not cause an error.

Action = a number between 0 and 11.

* Encoding Algorithm
  * Encoded_Byte = (Dino_Index * 12) + Action
* Decoding Algorithm
  * Dino_Index = floor(Encoded_Byte / 12)
  * Action = Encoded_Byte - (Dino_Index * 12)

## Dino Actions
There are 12 actions available to perform on Dinos. This is a list of these actions, what they do (if known) and how many arguments (bytes) they require. There are no optional arguments, so an omitted argument will bring Contest Data reading out of alignment and cause Undefined Behavior.
|Action Code|# of Arguments|Description|Delay (frames)|Function Breakpoint|Contest Trace Breakpoint|
|--|--|--|--|--|--|
|0|2|Set Neck Angle| |1E0C:36CA|9D4B:796||
|1|2|Set Tail Angle|Equal to speed|1E0C:39A2|9D4B:7D4||
|2|3|Move Dino|Equal to speed|1E0C:3B2A|9D4B:7EC||
|3|2|Set Breath Rate| |1E0C:3AE0|9D4B:820||
|4|1|Step Left/Right| |1E0C:3DC8|9D4B:836||
|5|1|Step Forward/Back| |1E0C:3FF2|9D4B:86C||
|6|1|Dino Die| |1E0C:3D48|9D4B:87C||
|7|1|Jump Left/Right|12|1E0C:3E6C|9D4B:894||
|8|1|Jump Forward/Back|16|1E0C:3F24|9D4B:8CA||
|9|0|Locks neck movement?| | |9D4B:8FE||
|10|0|Call| |1E0C:41F6|9D4B:90A||
|11|Up to 2|Special Actions| | |9D4B:916||

### Special Actions
|Action Code|Argument Code|# of Arguments|Description|Function Breakpoint|Contest Trace Breakpoint|
|--|--|--|--|--|--|
|11|0|1|Causes dino to die|N/A|9D4B:916||
|11|1|1|Set Armor Display lowest|N/A| ||
|11|2|1|Set Armor Display low|N/A| ||
|11|3|1|Set Armor Display medium-low|N/A| ||
|11|4|1|Set Armor Display medium|N/A| ||
|11|5|1|Set Armor Display thick|N/A| ||
|11|6|1|Set Armor Display thickest|N/A| ||
|11|7|2|Eat Food|1E0C:45FC| ||
|11|8|1|Attack/Fire|1E0C:4350| ||
|11|9|1|Frees neck movement?|N/A| ||

### Actions Comments
#### Set Neck Angle

Directly proportional to Argument 1 (speed)|The neck angle can be set via two modes, mode 0 is for swinging or aiming the head and mode 1 is for during fighting and firing (head shake). Argument 1 is the neck speed and mode together, where the speed is directly proportional to the number of frames it will take to make the movement; lower is faster. Mode 0 corresponds to odd numbers and mode 1 corresponds to even numbers. Argument 2 is the neck angle. This is a single byte which can represent a positive or negative number. To move the head left, use a negative number. To move the head right, use a positive number. Number 0 sets the neck straight.

#### Set Tail Angle

The tail angle is a visual tell of how agile a dino is while making a turn; the steeper the angle, the more agile the dino can be. Argument 1 is the tail speed. Argument 2 is the tail angle. This is a single byte which can represent a positive or negative number. To move the tail left, use a negative number. To move the tail right, use a positive number. 0 sets the tail straight.

#### Move Dino

This command is used to move the dino one "step". The arguments set the heading and speed. To set heading to the left, use a negative number. To set the heading to the right, use a positive number. Heading 0 keeps the dino going straight in whatever direction it is pointed. This is an absolute heading, so it is best to gradually adjust the heading when making turns. The third argument sets a array variable for the dino related to movement

## Movement Details
* Compare arg 0 - 1E0C:3BAE
* Switch - 1E0C:3CB5
* Or di - 1E0C:3CEC
* Compare var2 (species leg type) - 1E0C:3D06
* arg3 needs to be in lock step with the actual game

Creep movement is the easiest, arg3 stays 0

Walk is next easiest, sequence of arg3:
* 0
* 4
* 5 - continues on until stopping, where arg3 is set to 0

Run is the hardest and most complicated
* 0
* 9
* A
* A
* B - full speed
* D - slow down
* D - slow down
* 5 - slow down
* 5
* 5
* 0

  * Argument 3 memory location ds:65b8
  * Dino Number at ds:2F04
  * start - var2 = ax = 0

#### Set Breath Rate

The Dino's abdomen expands/contracts based on the arguments to simulate breathing and show Dino Status (Rested, Tired, etc)

#### Step Left/Right

Causes selected Dino to do fighting step side-to-side and rotate based on supplied argument. Quadruped and snake dinos use this

#### Step Forward/Back

Causes selected Dino to do fighting step forward or back and rotate based on supplied argument. Quadruped and snake dinos use this

#### Die

D8F1 when setting up dino, D8F2 when dino dies. This function is called repeatedly while other dinos alive and the game is still running

#### Jump Left/Right

Causes selected Dino to do fighting jump side-to-side and rotate based on supplied argument. Used only by biped dinos.

#### Jump Forward/Back

Causes selected Dino to do fighting jump forward or back and rotate based on the supplied argument. Used only by biped dinos.

#### Lock neck angle at current

Updates the same byte array as Special Action 11-9 to 1. Associated with firing? Move neck normal sets to 0

#### Call

The Dino does a Call/Roar

### Special Action Comments
This is a special action which based on the argument selects a unique action. Special action 7 requires an additional argument

#### 11-9
ds:5B5C + (dinoNum * 0x4B)
Updates the same byte array as Action 9 to 0. Associated with firing?



# Tracing Contest Execution
* Beginning of contestReadAllocate 9D4B:4CC
* Setup Contest Memory Size 9D4B:4EE
* Read contest data 9D4B:585
* Contest Memory Size final result 9D4B:5A1
* Beginning of contestReadFrame - 9D4B:5C2
* Continue reading data - 9D4B:5D2
* Read head of frame (num actions) - 9D4B:630
* Check read num actions - 9D4B:649
* num actions is 0 - 9D4B:A04
* num actions > 0 - 9D4B:657
* action value read from file - 9D4B:66E
* dino number decoded - 9D4B:68F
* action decoded - 9D4B:6BD

# File read trace
* 0823:FBC